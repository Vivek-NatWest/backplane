{"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\API\\BackplaneClient.ts":{"path":"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\API\\BackplaneClient.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":4,"column":27},"end":{"line":4,"column":65}},"3":{"start":{"line":7,"column":8},"end":{"line":7,"column":34}},"4":{"start":{"line":8,"column":8},"end":{"line":8,"column":37}},"5":{"start":{"line":9,"column":8},"end":{"line":9,"column":78}},"6":{"start":{"line":10,"column":8},"end":{"line":10,"column":42}},"7":{"start":{"line":11,"column":8},"end":{"line":11,"column":100}},"8":{"start":{"line":14,"column":8},"end":{"line":14,"column":83}},"9":{"start":{"line":15,"column":8},"end":{"line":15,"column":114}},"10":{"start":{"line":16,"column":8},"end":{"line":16,"column":83}},"11":{"start":{"line":17,"column":8},"end":{"line":17,"column":72}},"12":{"start":{"line":20,"column":8},"end":{"line":20,"column":98}},"13":{"start":{"line":21,"column":30},"end":{"line":21,"column":34}},"14":{"start":{"line":22,"column":8},"end":{"line":29,"column":9}},"15":{"start":{"line":23,"column":12},"end":{"line":28,"column":13}},"16":{"start":{"line":24,"column":16},"end":{"line":24,"column":104}},"17":{"start":{"line":27,"column":16},"end":{"line":27,"column":95}},"18":{"start":{"line":30,"column":33},"end":{"line":30,"column":65}},"19":{"start":{"line":31,"column":8},"end":{"line":35,"column":10}},"20":{"start":{"line":36,"column":8},"end":{"line":42,"column":10}},"21":{"start":{"line":39,"column":16},"end":{"line":39,"column":125}},"22":{"start":{"line":40,"column":16},"end":{"line":40,"column":62}},"23":{"start":{"line":45,"column":8},"end":{"line":45,"column":58}},"24":{"start":{"line":46,"column":8},"end":{"line":49,"column":9}},"25":{"start":{"line":47,"column":12},"end":{"line":47,"column":95}},"26":{"start":{"line":48,"column":12},"end":{"line":48,"column":19}},"27":{"start":{"line":50,"column":8},"end":{"line":50,"column":47}},"28":{"start":{"line":53,"column":8},"end":{"line":53,"column":65}},"29":{"start":{"line":54,"column":8},"end":{"line":54,"column":52}},"30":{"start":{"line":57,"column":8},"end":{"line":57,"column":73}},"31":{"start":{"line":58,"column":8},"end":{"line":59,"column":19}},"32":{"start":{"line":59,"column":12},"end":{"line":59,"column":19}},"33":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"34":{"start":{"line":61,"column":12},"end":{"line":61,"column":111}},"35":{"start":{"line":63,"column":22},"end":{"line":63,"column":70}},"36":{"start":{"line":63,"column":52},"end":{"line":63,"column":69}},"37":{"start":{"line":64,"column":8},"end":{"line":65,"column":79}},"38":{"start":{"line":65,"column":12},"end":{"line":65,"column":79}},"39":{"start":{"line":66,"column":8},"end":{"line":69,"column":9}},"40":{"start":{"line":67,"column":12},"end":{"line":67,"column":40}},"41":{"start":{"line":68,"column":12},"end":{"line":68,"column":45}},"42":{"start":{"line":70,"column":8},"end":{"line":70,"column":38}},"43":{"start":{"line":71,"column":34},"end":{"line":71,"column":67}},"44":{"start":{"line":72,"column":8},"end":{"line":82,"column":9}},"45":{"start":{"line":73,"column":35},"end":{"line":73,"column":73}},"46":{"start":{"line":75,"column":12},"end":{"line":80,"column":13}},"47":{"start":{"line":76,"column":16},"end":{"line":76,"column":134}},"48":{"start":{"line":79,"column":16},"end":{"line":79,"column":110}},"49":{"start":{"line":81,"column":12},"end":{"line":81,"column":54}},"50":{"start":{"line":83,"column":8},"end":{"line":86,"column":9}},"51":{"start":{"line":84,"column":12},"end":{"line":84,"column":68}},"52":{"start":{"line":85,"column":12},"end":{"line":85,"column":41}},"53":{"start":{"line":87,"column":8},"end":{"line":87,"column":33}},"54":{"start":{"line":90,"column":8},"end":{"line":90,"column":51}},"55":{"start":{"line":93,"column":8},"end":{"line":93,"column":66}},"56":{"start":{"line":94,"column":8},"end":{"line":95,"column":75}},"57":{"start":{"line":95,"column":12},"end":{"line":95,"column":75}},"58":{"start":{"line":96,"column":8},"end":{"line":96,"column":52}},"59":{"start":{"line":100,"column":8},"end":{"line":100,"column":139}},"60":{"start":{"line":101,"column":8},"end":{"line":109,"column":9}},"61":{"start":{"line":102,"column":12},"end":{"line":102,"column":44}},"62":{"start":{"line":103,"column":38},"end":{"line":103,"column":71}},"63":{"start":{"line":104,"column":12},"end":{"line":108,"column":13}},"64":{"start":{"line":105,"column":39},"end":{"line":105,"column":77}},"65":{"start":{"line":106,"column":16},"end":{"line":106,"column":101}},"66":{"start":{"line":107,"column":16},"end":{"line":107,"column":47}},"67":{"start":{"line":110,"column":8},"end":{"line":110,"column":33}},"68":{"start":{"line":113,"column":0},"end":{"line":113,"column":42}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":4},"end":{"line":6,"column":5}},"loc":{"start":{"line":6,"column":39},"end":{"line":12,"column":5}},"line":6},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":57},"end":{"line":18,"column":5}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":54},"end":{"line":43,"column":5}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":37,"column":25},"end":{"line":37,"column":26}},"loc":{"start":{"line":37,"column":31},"end":{"line":41,"column":13}},"line":37},"4":{"name":"(anonymous_4)","decl":{"start":{"line":44,"column":4},"end":{"line":44,"column":5}},"loc":{"start":{"line":44,"column":23},"end":{"line":51,"column":5}},"line":44},"5":{"name":"(anonymous_5)","decl":{"start":{"line":52,"column":4},"end":{"line":52,"column":5}},"loc":{"start":{"line":52,"column":24},"end":{"line":55,"column":5}},"line":52},"6":{"name":"(anonymous_6)","decl":{"start":{"line":56,"column":4},"end":{"line":56,"column":5}},"loc":{"start":{"line":56,"column":33},"end":{"line":88,"column":5}},"line":56},"7":{"name":"(anonymous_7)","decl":{"start":{"line":63,"column":47},"end":{"line":63,"column":48}},"loc":{"start":{"line":63,"column":52},"end":{"line":63,"column":69}},"line":63},"8":{"name":"(anonymous_8)","decl":{"start":{"line":89,"column":4},"end":{"line":89,"column":5}},"loc":{"start":{"line":89,"column":34},"end":{"line":91,"column":5}},"line":89},"9":{"name":"(anonymous_9)","decl":{"start":{"line":92,"column":4},"end":{"line":92,"column":5}},"loc":{"start":{"line":92,"column":24},"end":{"line":97,"column":5}},"line":92},"10":{"name":"(anonymous_10)","decl":{"start":{"line":98,"column":4},"end":{"line":98,"column":5}},"loc":{"start":{"line":98,"column":26},"end":{"line":111,"column":5}},"line":98}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":22},"end":{"line":9,"column":77}},"type":"cond-expr","locations":[{"start":{"line":9,"column":61},"end":{"line":9,"column":67}},{"start":{"line":9,"column":70},"end":{"line":9,"column":77}}],"line":9},"1":{"loc":{"start":{"line":9,"column":22},"end":{"line":9,"column":58}},"type":"binary-expr","locations":[{"start":{"line":9,"column":22},"end":{"line":9,"column":37}},{"start":{"line":9,"column":41},"end":{"line":9,"column":58}}],"line":9},"2":{"loc":{"start":{"line":14,"column":21},"end":{"line":14,"column":82}},"type":"cond-expr","locations":[{"start":{"line":14,"column":68},"end":{"line":14,"column":78}},{"start":{"line":14,"column":81},"end":{"line":14,"column":82}}],"line":14},"3":{"loc":{"start":{"line":14,"column":21},"end":{"line":14,"column":65}},"type":"binary-expr","locations":[{"start":{"line":14,"column":21},"end":{"line":14,"column":40}},{"start":{"line":14,"column":44},"end":{"line":14,"column":65}}],"line":14},"4":{"loc":{"start":{"line":15,"column":28},"end":{"line":15,"column":113}},"type":"cond-expr","locations":[{"start":{"line":15,"column":89},"end":{"line":15,"column":106}},{"start":{"line":15,"column":109},"end":{"line":15,"column":113}}],"line":15},"5":{"loc":{"start":{"line":15,"column":28},"end":{"line":15,"column":86}},"type":"binary-expr","locations":[{"start":{"line":15,"column":28},"end":{"line":15,"column":54}},{"start":{"line":15,"column":58},"end":{"line":15,"column":86}}],"line":15},"6":{"loc":{"start":{"line":22,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":29,"column":9}},{"start":{"line":22,"column":8},"end":{"line":29,"column":9}}],"line":22},"7":{"loc":{"start":{"line":23,"column":12},"end":{"line":28,"column":13}},"type":"if","locations":[{"start":{"line":23,"column":12},"end":{"line":28,"column":13}},{"start":{"line":23,"column":12},"end":{"line":28,"column":13}}],"line":23},"8":{"loc":{"start":{"line":39,"column":16},"end":{"line":39,"column":124}},"type":"cond-expr","locations":[{"start":{"line":39,"column":99},"end":{"line":39,"column":105}},{"start":{"line":39,"column":108},"end":{"line":39,"column":124}}],"line":39},"9":{"loc":{"start":{"line":39,"column":16},"end":{"line":39,"column":96}},"type":"binary-expr","locations":[{"start":{"line":39,"column":16},"end":{"line":39,"column":79}},{"start":{"line":39,"column":83},"end":{"line":39,"column":96}}],"line":39},"10":{"loc":{"start":{"line":46,"column":8},"end":{"line":49,"column":9}},"type":"if","locations":[{"start":{"line":46,"column":8},"end":{"line":49,"column":9}},{"start":{"line":46,"column":8},"end":{"line":49,"column":9}}],"line":46},"11":{"loc":{"start":{"line":58,"column":8},"end":{"line":59,"column":19}},"type":"if","locations":[{"start":{"line":58,"column":8},"end":{"line":59,"column":19}},{"start":{"line":58,"column":8},"end":{"line":59,"column":19}}],"line":58},"12":{"loc":{"start":{"line":58,"column":12},"end":{"line":58,"column":71}},"type":"binary-expr","locations":[{"start":{"line":58,"column":12},"end":{"line":58,"column":31}},{"start":{"line":58,"column":35},"end":{"line":58,"column":71}}],"line":58},"13":{"loc":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},{"start":{"line":60,"column":8},"end":{"line":62,"column":9}}],"line":60},"14":{"loc":{"start":{"line":64,"column":8},"end":{"line":65,"column":79}},"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":65,"column":79}},{"start":{"line":64,"column":8},"end":{"line":65,"column":79}}],"line":64},"15":{"loc":{"start":{"line":66,"column":8},"end":{"line":69,"column":9}},"type":"if","locations":[{"start":{"line":66,"column":8},"end":{"line":69,"column":9}},{"start":{"line":66,"column":8},"end":{"line":69,"column":9}}],"line":66},"16":{"loc":{"start":{"line":75,"column":12},"end":{"line":80,"column":13}},"type":"if","locations":[{"start":{"line":75,"column":12},"end":{"line":80,"column":13}},{"start":{"line":75,"column":12},"end":{"line":80,"column":13}}],"line":75},"17":{"loc":{"start":{"line":83,"column":8},"end":{"line":86,"column":9}},"type":"if","locations":[{"start":{"line":83,"column":8},"end":{"line":86,"column":9}},{"start":{"line":83,"column":8},"end":{"line":86,"column":9}}],"line":83},"18":{"loc":{"start":{"line":94,"column":8},"end":{"line":95,"column":75}},"type":"if","locations":[{"start":{"line":94,"column":8},"end":{"line":95,"column":75}},{"start":{"line":94,"column":8},"end":{"line":95,"column":75}}],"line":94},"19":{"loc":{"start":{"line":100,"column":68},"end":{"line":100,"column":137}},"type":"cond-expr","locations":[{"start":{"line":100,"column":123},"end":{"line":100,"column":129}},{"start":{"line":100,"column":132},"end":{"line":100,"column":137}}],"line":100},"20":{"loc":{"start":{"line":100,"column":68},"end":{"line":100,"column":120}},"type":"binary-expr","locations":[{"start":{"line":100,"column":68},"end":{"line":100,"column":103}},{"start":{"line":100,"column":107},"end":{"line":100,"column":120}}],"line":100},"21":{"loc":{"start":{"line":101,"column":8},"end":{"line":109,"column":9}},"type":"if","locations":[{"start":{"line":101,"column":8},"end":{"line":109,"column":9}},{"start":{"line":101,"column":8},"end":{"line":109,"column":9}}],"line":101},"22":{"loc":{"start":{"line":106,"column":16},"end":{"line":106,"column":100}},"type":"cond-expr","locations":[{"start":{"line":106,"column":75},"end":{"line":106,"column":81}},{"start":{"line":106,"column":84},"end":{"line":106,"column":100}}],"line":106},"23":{"loc":{"start":{"line":106,"column":16},"end":{"line":106,"column":72}},"type":"binary-expr","locations":[{"start":{"line":106,"column":16},"end":{"line":106,"column":55}},{"start":{"line":106,"column":59},"end":{"line":106,"column":72}}],"line":106}},"s":{"0":1,"1":1,"2":1,"3":8,"4":8,"5":8,"6":8,"7":8,"8":1,"9":1,"10":1,"11":0,"12":1,"13":1,"14":1,"15":0,"16":0,"17":0,"18":1,"19":1,"20":1,"21":0,"22":0,"23":1,"24":1,"25":1,"26":1,"27":0,"28":1,"29":1,"30":1,"31":1,"32":0,"33":1,"34":0,"35":1,"36":0,"37":1,"38":1,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":1,"55":1,"56":1,"57":1,"58":0,"59":1,"60":1,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":1,"68":1},"f":{"0":8,"1":1,"2":1,"3":0,"4":1,"5":1,"6":1,"7":0,"8":1,"9":1,"10":1},"b":{"0":[3,5],"1":[8,8],"2":[1,0],"3":[1,1],"4":[1,0],"5":[1,1],"6":[0,1],"7":[0,0],"8":[0,0],"9":[0,0],"10":[1,0],"11":[0,1],"12":[1,0],"13":[0,1],"14":[1,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[1,0],"19":[1,0],"20":[1,1],"21":[0,1],"22":[0,0],"23":[0,0]},"inputSourceMap":{"version":3,"file":"C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/API/BackplaneClient.ts","sources":["C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/API/BackplaneClient.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * SPDX-License-Identifier: Apache-2.0\r\n * Copyright 2021 FINOS FDC3 contributors - see NOTICE file\r\n */\r\n\r\nimport { ClientMiddleware } from '../service/ClientMiddleware';\r\nimport { AppIntent, Channel, Context, ContextHandler, Listener } from '@finos/fdc3';\r\nimport { BackplaneDiscoveryServiceClient } from '../discovery/BackplaneDiscoveryServiceClient';\r\nimport { BackplaneTransport } from '../transport/BackplaneTransport';\r\nimport { Logger } from 'ts-log';\r\nimport { ChannelsRepository } from '../repository/ChannelsRepository';\r\nimport { Fdc3Channel } from '../broadcast/channels/ChannelClient';\r\nimport { AppIdentifier } from '../DTO/receive/MessageEnvelope';\r\n\r\ninterface ContextTypeAndHandler {\r\n\tcontextTypeOrHandler: string | ContextHandler;\r\n\thandler?: ContextHandler;\r\n\tlistener: Listener | null;\r\n}\r\n\r\ninterface IntentAndHandler {\r\n\tintent: string;\r\n\thandler?: ContextHandler;\r\n\tlistener: Listener | null;\r\n}\r\n\r\nexport class BackplaneClient {\r\n\tprivate clientMiddleware: ClientMiddleware;\r\n\r\n\tprivate logger: Logger;\r\n\tprivate systemChannels: Array<Fdc3Channel>;\r\n\tprivate currentChannel: Fdc3Channel | undefined;\r\n\tprivate contextHandlers: { [key: string]: ContextTypeAndHandler } = {};\r\n\tprivate channelChanging = false;\r\n\r\n\tconstructor(appIdentifier: AppIdentifier, logger?: Logger) {\r\n\t\tthis.logger = logger ?? console;\r\n\t\tthis.systemChannels = new Array<Fdc3Channel>();\r\n\t\tthis.clientMiddleware = new ClientMiddleware(appIdentifier, this.logger);\r\n\t}\r\n\r\n\tasync initializeAsync(retryCount?: number, retryIntervalInMs?: number): Promise<void> {\r\n\t\tretryCount = retryCount ?? 3;\r\n\t\tretryIntervalInMs = retryIntervalInMs ?? 3000;\r\n\t\tawait this.clientMiddleware.initializeAsync(retryCount, retryIntervalInMs);\r\n\t\tthis.systemChannels = this.clientMiddleware.getSystemChannels();\r\n\t}\r\n\r\n\taddContextListener(handler: ContextHandler): Listener;\r\n\taddContextListener(contextType: string, handler: ContextHandler): Listener;\r\n\taddContextListener(contextTypeOrHandler: string | ContextHandler, handler?: ContextHandler): Listener {\r\n\t\tthis.logger.info('DesktopAgentClient: addContextListener', contextTypeOrHandler, handler);\r\n\t\tlet contextListener = null;\r\n\t\tif (this.currentChannel) {\r\n\t\t\tif (typeof contextTypeOrHandler === 'string') {\r\n\t\t\t\t//type of context listener is specified\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\tcontextListener = this.currentChannel.addContextListener(contextTypeOrHandler, handler);\r\n\t\t\t} else {\r\n\t\t\t\tcontextListener = this.currentChannel.addContextListener(contextTypeOrHandler);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst contextHandlerId = Date.now() + '_' + Math.random();\r\n\t\tthis.contextHandlers[contextHandlerId] = {\r\n\t\t\tcontextTypeOrHandler,\r\n\t\t\thandler,\r\n\t\t\tlistener: contextListener,\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tunsubscribe: () => {\r\n\t\t\t\tthis.contextHandlers[contextHandlerId].listener?.unsubscribe();\r\n\t\t\t\tdelete this.contextHandlers[contextHandlerId];\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tbroadcast(context: Context): void {\r\n\t\tthis.logger.info('DesktopAgentClient: broadcast');\r\n\t\tif (this.currentChannel == undefined) {\r\n\t\t\tthis.logger.warn('DesktopAgentClient: No channel joined. Broadcast has no effect');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.currentChannel.broadcast(context);\r\n\t}\r\n\r\n\tgetSystemChannels(): Promise<Channel[]> {\r\n\t\tthis.logger.info('DesktopAgentClient: getSystemChannel');\r\n\t\treturn Promise.resolve(this.systemChannels);\r\n\t}\r\n\r\n\tasync joinChannel(channelId: string): Promise<void> {\r\n\t\tthis.logger.info(`DesktopAgentClient: joinChannel ${channelId}`);\r\n\t\tif (this.currentChannel && this.currentChannel.id === channelId) return;\r\n\t\tif (this.channelChanging) {\r\n\t\t\tthrow new Error('Currently in process of changing channels. Rejecting this request. ' + channelId);\r\n\t\t}\r\n\t\tlet channel = this.systemChannels.find(x => x.id == channelId);\r\n\t\tif (channel == undefined) return Promise.reject('DesktopAgentClient: No such channel exist');\r\n\t\t// unsubscribe to everything that was already subscribed\r\n\t\tif (this.currentChannel) {\r\n\t\t\tthis.channelChanging = true;\r\n\t\t\tawait this.leaveCurrentChannel();\r\n\t\t}\r\n\r\n\t\tthis.currentChannel = channel;\r\n\t\tconst contextHandlerIds = Object.keys(this.contextHandlers);\r\n\t\tfor (const contextHandlerId of contextHandlerIds) {\r\n\t\t\tconst contextHandler = this.contextHandlers[contextHandlerId];\r\n\t\t\tlet contextListener;\r\n\t\t\tif (typeof contextHandler.contextTypeOrHandler === 'string') {\r\n\t\t\t\tcontextListener = this.currentChannel.addContextListener(\r\n\t\t\t\t\tcontextHandler.contextTypeOrHandler,\r\n\t\t\t\t\tcontextHandler.handler!\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tcontextListener = this.currentChannel.addContextListener(contextHandler.contextTypeOrHandler);\r\n\t\t\t}\r\n\t\t\tcontextHandler.listener = contextListener;\r\n\t\t}\r\n\r\n\t\tif (this.channelChanging) {\r\n\t\t\tthis.logger.log('done Changing channel to ', channelId);\r\n\t\t\tthis.channelChanging = false;\r\n\t\t}\r\n\t\treturn Promise.resolve();\r\n\t}\r\n\r\n\tgetOrCreateChannel(channelId: string): Promise<Channel> {\r\n\t\tthrow new Error('Method not implemented.');\r\n\t}\r\n\r\n\tgetCurrentChannel(): Promise<Channel> {\r\n\t\tthis.logger.info(`DesktopAgentClient: getCurrentChannel`);\r\n\t\tif (this.currentChannel == undefined) return Promise.reject('DesktopAgentClient: no channel joined');\r\n\t\treturn Promise.resolve(this.currentChannel);\r\n\t}\r\n\r\n\tleaveCurrentChannel(): Promise<void> {\r\n\t\tthis.logger.info('DesktopAgentClient: leaveCurrentChannel', this.currentChannel?.id);\r\n\t\tif (this.currentChannel) {\r\n\t\t\tthis.currentChannel = undefined;\r\n\t\t\tconst contextHandlerIds = Object.keys(this.contextHandlers);\r\n\t\t\tfor (const contextHandlerId of contextHandlerIds) {\r\n\t\t\t\tconst contextHandler = this.contextHandlers[contextHandlerId];\r\n\t\t\t\tcontextHandler.listener?.unsubscribe();\r\n\t\t\t\tcontextHandler.listener = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Promise.resolve();\r\n\t}\r\n}\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"cd280d7841658d58898467cbf1baf575b9fe1b46"},"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\service\\ClientMiddleware.ts":{"path":"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\service\\ClientMiddleware.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":34}},"2":{"start":{"line":4,"column":29},"end":{"line":4,"column":71}},"3":{"start":{"line":5,"column":32},"end":{"line":5,"column":75}},"4":{"start":{"line":6,"column":42},"end":{"line":6,"column":97}},"5":{"start":{"line":7,"column":29},"end":{"line":7,"column":72}},"6":{"start":{"line":10,"column":8},"end":{"line":10,"column":165}},"7":{"start":{"line":11,"column":8},"end":{"line":11,"column":117}},"8":{"start":{"line":12,"column":8},"end":{"line":12,"column":43}},"9":{"start":{"line":13,"column":8},"end":{"line":13,"column":41}},"10":{"start":{"line":14,"column":8},"end":{"line":14,"column":162}},"11":{"start":{"line":14,"column":56},"end":{"line":14,"column":160}},"12":{"start":{"line":15,"column":8},"end":{"line":15,"column":29}},"13":{"start":{"line":18,"column":8},"end":{"line":18,"column":59}},"14":{"start":{"line":21,"column":8},"end":{"line":21,"column":85}},"15":{"start":{"line":22,"column":8},"end":{"line":22,"column":85}},"16":{"start":{"line":25,"column":22},"end":{"line":25,"column":64}},"17":{"start":{"line":26,"column":8},"end":{"line":27,"column":72}},"18":{"start":{"line":27,"column":12},"end":{"line":27,"column":72}},"19":{"start":{"line":28,"column":8},"end":{"line":28,"column":160}},"20":{"start":{"line":32,"column":8},"end":{"line":32,"column":97}},"21":{"start":{"line":33,"column":18},"end":{"line":33,"column":96}},"22":{"start":{"line":34,"column":8},"end":{"line":42,"column":9}},"23":{"start":{"line":35,"column":12},"end":{"line":35,"column":81}},"24":{"start":{"line":36,"column":12},"end":{"line":36,"column":103}},"25":{"start":{"line":37,"column":12},"end":{"line":37,"column":80}},"26":{"start":{"line":40,"column":12},"end":{"line":40,"column":53}},"27":{"start":{"line":41,"column":12},"end":{"line":41,"column":67}},"28":{"start":{"line":43,"column":8},"end":{"line":49,"column":10}},"29":{"start":{"line":45,"column":16},"end":{"line":45,"column":79}},"30":{"start":{"line":46,"column":27},"end":{"line":46,"column":56}},"31":{"start":{"line":47,"column":16},"end":{"line":47,"column":109}},"32":{"start":{"line":52,"column":0},"end":{"line":52,"column":44}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":4},"end":{"line":9,"column":5}},"loc":{"start":{"line":9,"column":39},"end":{"line":16,"column":5}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":50},"end":{"line":14,"column":51}},"loc":{"start":{"line":14,"column":56},"end":{"line":14,"column":160}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":17,"column":4},"end":{"line":17,"column":5}},"loc":{"start":{"line":17,"column":24},"end":{"line":19,"column":5}},"line":17},"3":{"name":"(anonymous_3)","decl":{"start":{"line":20,"column":4},"end":{"line":20,"column":5}},"loc":{"start":{"line":20,"column":57},"end":{"line":23,"column":5}},"line":20},"4":{"name":"(anonymous_4)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":41},"end":{"line":29,"column":5}},"line":24},"5":{"name":"(anonymous_5)","decl":{"start":{"line":30,"column":4},"end":{"line":30,"column":5}},"loc":{"start":{"line":30,"column":56},"end":{"line":50,"column":5}},"line":30},"6":{"name":"(anonymous_6)","decl":{"start":{"line":44,"column":25},"end":{"line":44,"column":26}},"loc":{"start":{"line":44,"column":31},"end":{"line":48,"column":13}},"line":44}},"branchMap":{"0":{"loc":{"start":{"line":26,"column":8},"end":{"line":27,"column":72}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":27,"column":72}},{"start":{"line":26,"column":8},"end":{"line":27,"column":72}}],"line":26},"1":{"loc":{"start":{"line":34,"column":8},"end":{"line":42,"column":9}},"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":42,"column":9}},{"start":{"line":34,"column":8},"end":{"line":42,"column":9}}],"line":34},"2":{"loc":{"start":{"line":36,"column":12},"end":{"line":36,"column":102}},"type":"cond-expr","locations":[{"start":{"line":36,"column":77},"end":{"line":36,"column":83}},{"start":{"line":36,"column":86},"end":{"line":36,"column":102}}],"line":36},"3":{"loc":{"start":{"line":36,"column":12},"end":{"line":36,"column":74}},"type":"binary-expr","locations":[{"start":{"line":36,"column":12},"end":{"line":36,"column":57}},{"start":{"line":36,"column":61},"end":{"line":36,"column":74}}],"line":36}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":16,"7":16,"8":16,"9":16,"10":16,"11":0,"12":16,"13":0,"14":1,"15":0,"16":2,"17":2,"18":2,"19":0,"20":3,"21":3,"22":3,"23":0,"24":0,"25":0,"26":3,"27":3,"28":3,"29":1,"30":1,"31":1,"32":1},"f":{"0":16,"1":0,"2":0,"3":1,"4":2,"5":3,"6":1},"b":{"0":[2,0],"1":[0,3],"2":[0,0],"3":[0,0]},"inputSourceMap":{"version":3,"file":"C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/service/ClientMiddleware.ts","sources":["C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/service/ClientMiddleware.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * SPDX-License-Identifier: Apache-2.0\r\n * Copyright 2021 FINOS FDC3 contributors - see NOTICE file\r\n */\r\n\r\nimport { BackplaneTransport } from '../transport/BackplaneTransport';\r\nimport { Logger } from 'ts-log';\r\nimport { Context, ContextHandler, Listener } from '@finos/fdc3';\r\nimport {\r\n\tbuildBroadcastEnvelop,\r\n\tgetBroadcastContextMapKey,\r\n\tonHubConnection,\r\n\tunsubscribeUtil,\r\n} from '../utility/ClientMiddlewareUtils';\r\nimport { HubConnection } from '@microsoft/signalr';\r\nimport { AppIdentifier } from '../DTO/receive/MessageEnvelope';\r\nimport { BackplaneDiscoveryServiceClient } from '../discovery/BackplaneDiscoveryServiceClient';\r\nimport { ChannelsRepository } from '../repository/ChannelsRepository';\r\nimport { Fdc3Channel } from '../broadcast/channels/ChannelClient';\r\n\r\nexport class ClientMiddleware {\r\n\tprivate backplaneTransport: BackplaneTransport;\r\n\tprivate contextHandlers: Map<string, ContextHandler[]>;\r\n\tprivate logger: Logger;\r\n\tprivate appIdentifier: AppIdentifier;\r\n\tprivate channelsRepository: ChannelsRepository;\r\n\r\n\tconstructor(appIdentifier: AppIdentifier, logger: Logger) {\r\n\t\tthis.backplaneTransport = new BackplaneTransport(new BackplaneDiscoveryServiceClient(logger), logger);\r\n\t\tthis.channelsRepository = new ChannelsRepository(this.backplaneTransport, this, logger);\r\n\t\tthis.appIdentifier = appIdentifier;\r\n\t\tthis.contextHandlers = new Map<string, ContextHandler[]>();\r\n\t\tthis.backplaneTransport.registerOnConnect(() =>\r\n\t\t\tonHubConnection(this.logger, this.backplaneTransport, this.contextHandlers)\r\n\t\t);\r\n\t\tthis.logger = logger;\r\n\t}\r\n\r\n\tgetSystemChannels(): Fdc3Channel[] {\r\n\t\treturn this.channelsRepository.getSystemChannels();\r\n\t}\r\n\r\n\tasync initializeAsync(retryCount: number, retryIntervalInMs: number): Promise<void> {\r\n\t\tawait this.backplaneTransport.initializeAsync(retryCount, retryIntervalInMs);\r\n\t\tawait this.channelsRepository.InitializeAsync(retryCount, retryIntervalInMs);\r\n\t}\r\n\r\n\tbroadcastContext(context: Context, channelId: string): void {\r\n\t\tlet hubConn: HubConnection | undefined = this.backplaneTransport.getHubConnection();\r\n\t\tif (hubConn == undefined) throw Error('Invalid operation: Transport not initialized');\r\n\t\thubConn.invoke(\r\n\t\t\t'Broadcast',\r\n\t\t\tJSON.parse(buildBroadcastEnvelop(this.appIdentifier, context, channelId, this.logger)),\r\n\t\t\tfalse\r\n\t\t);\r\n\t}\r\n\r\n\taddContextListener(contextType: string | undefined, handler: ContextHandler, channelId: string): Listener {\r\n\t\tthis.logger.info(`Registering contextType: ${contextType} for listening from backplane`);\r\n\t\tlet key: string = getBroadcastContextMapKey(contextType, channelId);\r\n\t\tif (this.contextHandlers.has(key)) {\r\n\t\t\tthis.logger.info(`ContextType already found. Registering handler..`);\r\n\t\t\tthis.contextHandlers.get(key)?.push(handler);\r\n\t\t\tthis.logger.info(`Registered handler successfully: ${contextType}`);\r\n\t\t} else {\r\n\t\t\tthis.contextHandlers.set(key, [handler]);\r\n\t\t\tthis.logger.info(`Registered contextType and handler`);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tunsubscribe: (): void => {\r\n\t\t\t\tthis.logger.info(`Unsubscribe called for contextType: ${key}`);\r\n\t\t\t\tlet item: ContextHandler[] | undefined = this.contextHandlers.get(key);\r\n\t\t\t\tunsubscribeUtil(this.logger, item, 'contextType', key, handler);\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n}\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"880152b71b6138ea24dc84e6c3de1bb0065e9353"},"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\transport\\BackplaneTransport.ts":{"path":"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\transport\\BackplaneTransport.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":36}},"4":{"start":{"line":7,"column":19},"end":{"line":7,"column":55}},"5":{"start":{"line":8,"column":33},"end":{"line":8,"column":77}},"6":{"start":{"line":11,"column":8},"end":{"line":11,"column":36}},"7":{"start":{"line":12,"column":8},"end":{"line":12,"column":29}},"8":{"start":{"line":13,"column":8},"end":{"line":13,"column":67}},"9":{"start":{"line":16,"column":8},"end":{"line":16,"column":138}},"10":{"start":{"line":17,"column":8},"end":{"line":19,"column":202}},"11":{"start":{"line":19,"column":43},"end":{"line":19,"column":200}},"12":{"start":{"line":22,"column":8},"end":{"line":22,"column":47}},"13":{"start":{"line":23,"column":8},"end":{"line":23,"column":77}},"14":{"start":{"line":26,"column":8},"end":{"line":26,"column":34}},"15":{"start":{"line":29,"column":0},"end":{"line":29,"column":48}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":4},"end":{"line":10,"column":5}},"loc":{"start":{"line":10,"column":51},"end":{"line":14,"column":5}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":57},"end":{"line":20,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":31},"end":{"line":19,"column":32}},"loc":{"start":{"line":19,"column":43},"end":{"line":19,"column":200}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":33},"end":{"line":24,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":25,"column":4},"end":{"line":25,"column":5}},"loc":{"start":{"line":25,"column":23},"end":{"line":27,"column":5}},"line":25}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":24,"7":24,"8":24,"9":2,"10":2,"11":4,"12":17,"13":17,"14":5,"15":1},"f":{"0":1,"1":24,"2":2,"3":4,"4":17,"5":5},"b":{"0":[1,1,1],"1":[0,1],"2":[1,1]},"inputSourceMap":{"version":3,"file":"C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/transport/BackplaneTransport.ts","sources":["C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/transport/BackplaneTransport.ts"],"names":[],"mappings":";;;;;;AAMA,wDAA6B;AAG7B,8EAAqF;AAErF,MAAa,kBAAkB;IAM9B,YAAY,yBAA0D,EAAE,MAAc;QAH9E,sBAAiB,GAAmB,EAAE,CAAC;QAI9C,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,yBAAyB,GAAG,yBAAyB,CAAC;IAC5D,CAAC;IAED,KAAK,CAAC,eAAe,CAAC,UAAkB,EAAE,iBAAyB;QAClE,IAAI,CAAC,MAAM,CAAC,IAAI,CACf,uDAAuD,UAAU,2BAA2B,iBAAiB,EAAE,CAC/G,CAAC;QACF,MAAM,IAAA,kBAAK,GAAE;aACX,YAAY,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;aACvD,iBAAiB,CACjB,KAAK,IAAI,EAAE,CACV,MAAM,IAAA,yDAAgC,EACrC,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,yBAAyB,EAC9B,IAAI,CAAC,aAAa,EAClB,IAAI,CAAC,iBAAiB,CACtB,CACF,CAAC;IACJ,CAAC;IAED,iBAAiB,CAAC,SAAqB;QACtC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACvC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,kDAAkD,CAAC,CAAC;IACtE,CAAC;IAED,gBAAgB;QACf,OAAO,IAAI,CAAC,aAAa,CAAC;IAC3B,CAAC;CACD;AApCD,gDAoCC","sourcesContent":["/**\r\n * SPDX-License-Identifier: Apache-2.0\r\n * Copyright 2021 FINOS FDC3 contributors - see NOTICE file\r\n */\r\n\r\nimport { HubConnection, HubConnectionBuilder } from '@microsoft/signalr';\r\nimport polly from 'polly-js';\r\nimport { Logger } from 'ts-log';\r\nimport { BackplaneDiscoveryServiceClient } from '../discovery/BackplaneDiscoveryServiceClient';\r\nimport { createAndStartHubConnectionAsync } from '../utility/BackplaneTransportUtil';\r\n\r\nexport class BackplaneTransport {\r\n\tprivate backplaneServiceDiscovery: BackplaneDiscoveryServiceClient;\r\n\tprivate hubConnection: HubConnection | undefined;\r\n\tprivate onConnectHandlers: { (): void }[] = [];\r\n\tprivate logger: Logger;\r\n\r\n\tconstructor(backplaneServiceDiscovery: BackplaneDiscoveryServiceClient, logger: Logger) {\r\n\t\tthis.logger = logger;\r\n\t\tthis.backplaneServiceDiscovery = backplaneServiceDiscovery;\r\n\t}\r\n\r\n\tasync initializeAsync(retryCount: number, retryIntervalInMs: number): Promise<void> {\r\n\t\tthis.logger.info(\r\n\t\t\t`Initializing backplane connection with retry count: ${retryCount} and retryIntervalInMs: ${retryIntervalInMs}`\r\n\t\t);\r\n\t\tawait polly()\r\n\t\t\t.waitAndRetry(Array(retryCount).fill(retryIntervalInMs))\r\n\t\t\t.executeForPromise(\r\n\t\t\t\tasync () =>\r\n\t\t\t\t\tawait createAndStartHubConnectionAsync(\r\n\t\t\t\t\t\tthis.logger,\r\n\t\t\t\t\t\tthis.backplaneServiceDiscovery,\r\n\t\t\t\t\t\tthis.hubConnection,\r\n\t\t\t\t\t\tthis.onConnectHandlers\r\n\t\t\t\t\t)\r\n\t\t\t);\r\n\t}\r\n\r\n\tregisterOnConnect(onConnect: () => void): void {\r\n\t\tthis.onConnectHandlers.push(onConnect);\r\n\t\tthis.logger.info(`SignalR: Registered for callback on reconnect ..`);\r\n\t}\r\n\r\n\tgetHubConnection(): HubConnection | undefined {\r\n\t\treturn this.hubConnection;\r\n\t}\r\n}\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d4cd97214db3894d43fb8cf389f4b3b15167068e"},"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\utility\\BackplaneTransportUtil.ts":{"path":"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\utility\\BackplaneTransportUtil.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":50}},"4":{"start":{"line":7,"column":18},"end":{"line":7,"column":47}},"5":{"start":{"line":8,"column":19},"end":{"line":8,"column":55}},"6":{"start":{"line":9,"column":23},"end":{"line":9,"column":57}},"7":{"start":{"line":10,"column":41},"end":{"line":26,"column":1}},"8":{"start":{"line":11,"column":4},"end":{"line":11,"column":52}},"9":{"start":{"line":12,"column":27},"end":{"line":12,"column":111}},"10":{"start":{"line":13,"column":4},"end":{"line":13,"column":52}},"11":{"start":{"line":14,"column":4},"end":{"line":14,"column":35}},"12":{"start":{"line":15,"column":4},"end":{"line":15,"column":43}},"13":{"start":{"line":16,"column":4},"end":{"line":24,"column":7}},"14":{"start":{"line":17,"column":8},"end":{"line":23,"column":9}},"15":{"start":{"line":18,"column":12},"end":{"line":18,"column":31}},"16":{"start":{"line":19,"column":12},"end":{"line":19,"column":80}},"17":{"start":{"line":22,"column":12},"end":{"line":22,"column":85}},"18":{"start":{"line":25,"column":4},"end":{"line":25,"column":28}},"19":{"start":{"line":27,"column":0},"end":{"line":27,"column":76}},"20":{"start":{"line":28,"column":31},"end":{"line":41,"column":1}},"21":{"start":{"line":29,"column":4},"end":{"line":29,"column":64}},"22":{"start":{"line":30,"column":33},"end":{"line":30,"column":95}},"23":{"start":{"line":31,"column":17},"end":{"line":31,"column":59}},"24":{"start":{"line":32,"column":4},"end":{"line":32,"column":68}},"25":{"start":{"line":33,"column":4},"end":{"line":33,"column":139}},"26":{"start":{"line":34,"column":4},"end":{"line":34,"column":96}},"27":{"start":{"line":34,"column":42},"end":{"line":34,"column":94}},"28":{"start":{"line":35,"column":4},"end":{"line":39,"column":7}},"29":{"start":{"line":36,"column":8},"end":{"line":36,"column":65}},"30":{"start":{"line":37,"column":8},"end":{"line":37,"column":57}},"31":{"start":{"line":38,"column":8},"end":{"line":38,"column":117}},"32":{"start":{"line":40,"column":4},"end":{"line":40,"column":25}},"33":{"start":{"line":42,"column":42},"end":{"line":46,"column":1}},"34":{"start":{"line":43,"column":4},"end":{"line":45,"column":157}},"35":{"start":{"line":45,"column":39},"end":{"line":45,"column":155}},"36":{"start":{"line":47,"column":44},"end":{"line":54,"column":1}},"37":{"start":{"line":48,"column":4},"end":{"line":51,"column":5}},"38":{"start":{"line":49,"column":8},"end":{"line":49,"column":100}},"39":{"start":{"line":50,"column":8},"end":{"line":50,"column":29}},"40":{"start":{"line":52,"column":4},"end":{"line":52,"column":92}},"41":{"start":{"line":53,"column":4},"end":{"line":53,"column":138}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":41},"end":{"line":10,"column":42}},"loc":{"start":{"line":10,"column":131},"end":{"line":26,"column":1}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":30},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":58},"end":{"line":24,"column":5}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":31},"end":{"line":28,"column":32}},"loc":{"start":{"line":28,"column":121},"end":{"line":41,"column":1}},"line":28},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":33},"end":{"line":34,"column":34}},"loc":{"start":{"line":34,"column":42},"end":{"line":34,"column":94}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":35,"column":26},"end":{"line":35,"column":27}},"loc":{"start":{"line":35,"column":43},"end":{"line":39,"column":5}},"line":35},"6":{"name":"(anonymous_6)","decl":{"start":{"line":42,"column":42},"end":{"line":42,"column":43}},"loc":{"start":{"line":42,"column":132},"end":{"line":46,"column":1}},"line":42},"7":{"name":"(anonymous_7)","decl":{"start":{"line":45,"column":27},"end":{"line":45,"column":28}},"loc":{"start":{"line":45,"column":39},"end":{"line":45,"column":155}},"line":45},"8":{"name":"(anonymous_8)","decl":{"start":{"line":47,"column":44},"end":{"line":47,"column":45}},"loc":{"start":{"line":47,"column":134},"end":{"line":54,"column":1}},"line":47}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":10,"column":104},"end":{"line":10,"column":126}},"type":"default-arg","locations":[{"start":{"line":10,"column":124},"end":{"line":10,"column":126}}],"line":10},"4":{"loc":{"start":{"line":28,"column":94},"end":{"line":28,"column":116}},"type":"default-arg","locations":[{"start":{"line":28,"column":114},"end":{"line":28,"column":116}}],"line":28},"5":{"loc":{"start":{"line":42,"column":105},"end":{"line":42,"column":127}},"type":"default-arg","locations":[{"start":{"line":42,"column":125},"end":{"line":42,"column":127}}],"line":42},"6":{"loc":{"start":{"line":47,"column":107},"end":{"line":47,"column":129}},"type":"default-arg","locations":[{"start":{"line":47,"column":127},"end":{"line":47,"column":129}}],"line":47},"7":{"loc":{"start":{"line":48,"column":4},"end":{"line":51,"column":5}},"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":51,"column":5}},{"start":{"line":48,"column":4},"end":{"line":51,"column":5}}],"line":48},"8":{"loc":{"start":{"line":48,"column":8},"end":{"line":48,"column":59}},"type":"binary-expr","locations":[{"start":{"line":48,"column":8},"end":{"line":48,"column":21}},{"start":{"line":48,"column":25},"end":{"line":48,"column":59}}],"line":48}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":4,"9":4,"10":4,"11":4,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":1,"20":1,"21":4,"22":4,"23":4,"24":4,"25":4,"26":4,"27":0,"28":4,"29":0,"30":0,"31":0,"32":4,"33":1,"34":0,"35":0,"36":1,"37":0,"38":0,"39":0,"40":0,"41":0},"f":{"0":1,"1":4,"2":0,"3":4,"4":0,"5":0,"6":0,"7":0,"8":0},"b":{"0":[1,1,1],"1":[0,1],"2":[1,1],"3":[0],"4":[4],"5":[0],"6":[0],"7":[0,0],"8":[0,0]},"inputSourceMap":{"version":3,"file":"C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/utility/BackplaneTransportUtil.ts","sources":["C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/utility/BackplaneTransportUtil.ts"],"names":[],"mappings":"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","sourcesContent":["import { HubConnection, HubConnectionBuilder } from '@microsoft/signalr';\r\nimport polly from 'polly-js';\r\nimport { Logger } from 'ts-log';\r\nimport { BackplaneDiscoveryServiceClient } from '../discovery/BackplaneDiscoveryServiceClient';\r\nimport { LogForwarder } from '../logging/LogForwarder';\r\n\r\nexport const createAndStartHubConnectionAsync = async (\r\n\tlogger: Logger,\r\n\tbackplaneDiscoveryServiceClient: BackplaneDiscoveryServiceClient,\r\n\thubConnection: HubConnection | undefined,\r\n\tonConnectHandlers: { (): void }[] = []\r\n): Promise<HubConnection> => {\r\n\tlogger.info(`SignalR: Building hub connection`);\r\n\tlet hubConnectionNew: HubConnection | undefined = await buildSignalRConnection(\r\n\t\tlogger,\r\n\t\tbackplaneDiscoveryServiceClient,\r\n\t\thubConnection\r\n\t);\r\n\tlogger.info(`SignalR: Starting hub connection`);\r\n\tawait hubConnectionNew.start();\r\n\tlogger.info('SignalR: Hub Connected.');\r\n\tonConnectHandlers.forEach(async onConnectHandler => {\r\n\t\ttry {\r\n\t\t\tonConnectHandler();\r\n\t\t\tlogger.info(`Successfully invoked callback for onconnect over hub`);\r\n\t\t} catch (err) {\r\n\t\t\tlogger.error(`Failed to invoke callback for onconnect over Hub: ${err}`);\r\n\t\t}\r\n\t});\r\n\treturn hubConnectionNew;\r\n};\r\n\r\nconst buildSignalRConnection = async (\r\n\tlogger: Logger,\r\n\tbackplaneDiscoveryServiceClient: BackplaneDiscoveryServiceClient,\r\n\thubConnection: HubConnection | undefined,\r\n\tonConnectHandlers: { (): void }[] = []\r\n): Promise<HubConnection> => {\r\n\tlogger.info(`Discovering backplane from service discovery`);\r\n\tlet backplaneUrlDiscovered: string = await backplaneDiscoveryServiceClient.discoverBackplaneAsync();\r\n\tlet hubUrl: string = `${backplaneUrlDiscovered}/backplane/v1.0`;\r\n\tlogger.info(`signalR: Building connection with url: ${hubUrl}`);\r\n\thubConnection = new HubConnectionBuilder().withUrl(hubUrl).configureLogging(new LogForwarder(logger)).build();\r\n\thubConnection.onreconnecting(error => logger.warn(`SignalR: Hub reconnecting...${error}.`));\r\n\thubConnection.onclose(async error => {\r\n\t\tlogger.error(`SignalR: hub connection closed.${error}.`);\r\n\t\tlogger.info(`SignalR: Initiating reconnect ...`);\r\n\t\tcreateAndStartConnectionWithRetry(logger, backplaneDiscoveryServiceClient, hubConnection, onConnectHandlers);\r\n\t});\r\n\treturn hubConnection;\r\n};\r\n\r\nconst createAndStartConnectionWithRetry = async (\r\n\tlogger: Logger,\r\n\tbackplaneDiscoveryServiceClient: BackplaneDiscoveryServiceClient,\r\n\thubConnection: HubConnection | undefined,\r\n\tonConnectHandlers: { (): void }[] = []\r\n): Promise<void> => {\r\n\t//keep retrying connection for 24 hours.\r\n\tawait polly()\r\n\t\t.waitAndRetry(Array(28800).fill(3000))\r\n\t\t.executeForPromise(\r\n\t\t\tasync () =>\r\n\t\t\t\tawait getExistingOrCreateNewHubConnection(\r\n\t\t\t\t\tlogger,\r\n\t\t\t\t\tbackplaneDiscoveryServiceClient,\r\n\t\t\t\t\thubConnection,\r\n\t\t\t\t\tonConnectHandlers\r\n\t\t\t\t)\r\n\t\t);\r\n};\r\n\r\nconst getExistingOrCreateNewHubConnection = async (\r\n\tlogger: Logger,\r\n\tbackplaneDiscoveryServiceClient: BackplaneDiscoveryServiceClient,\r\n\thubConnection: HubConnection | undefined,\r\n\tonConnectHandlers: { (): void }[] = []\r\n): Promise<HubConnection> => {\r\n\tif (hubConnection && hubConnection.state == 'Connected') {\r\n\t\tlogger.info(`SignalR: Hub connection already established. Returning existing connection..`);\r\n\t\treturn hubConnection;\r\n\t}\r\n\tlogger.warn(`SignalR: Existing hub connection not found. Initiating new connection...`);\r\n\treturn await createAndStartHubConnectionAsync(\r\n\t\tlogger,\r\n\t\tbackplaneDiscoveryServiceClient,\r\n\t\thubConnection,\r\n\t\tonConnectHandlers\r\n\t);\r\n};\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9b3aaa504569c81482addb60b9ed14b57302b9a2"},"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\logging\\LogForwarder.ts":{"path":"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\logging\\LogForwarder.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":30}},"2":{"start":{"line":4,"column":18},"end":{"line":4,"column":47}},"3":{"start":{"line":7,"column":8},"end":{"line":7,"column":40}},"4":{"start":{"line":10,"column":8},"end":{"line":28,"column":9}},"5":{"start":{"line":12,"column":16},"end":{"line":12,"column":51}},"6":{"start":{"line":13,"column":16},"end":{"line":13,"column":22}},"7":{"start":{"line":15,"column":16},"end":{"line":15,"column":50}},"8":{"start":{"line":16,"column":16},"end":{"line":16,"column":22}},"9":{"start":{"line":18,"column":16},"end":{"line":18,"column":51}},"10":{"start":{"line":19,"column":16},"end":{"line":19,"column":22}},"11":{"start":{"line":21,"column":16},"end":{"line":21,"column":51}},"12":{"start":{"line":22,"column":16},"end":{"line":22,"column":22}},"13":{"start":{"line":24,"column":16},"end":{"line":24,"column":50}},"14":{"start":{"line":25,"column":16},"end":{"line":25,"column":22}},"15":{"start":{"line":27,"column":16},"end":{"line":27,"column":22}},"16":{"start":{"line":31,"column":0},"end":{"line":31,"column":36}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":6,"column":4},"end":{"line":6,"column":5}},"loc":{"start":{"line":6,"column":27},"end":{"line":8,"column":5}},"line":6},"1":{"name":"(anonymous_1)","decl":{"start":{"line":9,"column":4},"end":{"line":9,"column":5}},"loc":{"start":{"line":9,"column":27},"end":{"line":29,"column":5}},"line":9}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":8},"end":{"line":28,"column":9}},"type":"switch","locations":[{"start":{"line":11,"column":12},"end":{"line":13,"column":22}},{"start":{"line":14,"column":12},"end":{"line":16,"column":22}},{"start":{"line":17,"column":12},"end":{"line":19,"column":22}},{"start":{"line":20,"column":12},"end":{"line":22,"column":22}},{"start":{"line":23,"column":12},"end":{"line":25,"column":22}},{"start":{"line":26,"column":12},"end":{"line":27,"column":22}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":9,"4":33,"5":9,"6":9,"7":5,"8":5,"9":17,"10":17,"11":1,"12":1,"13":1,"14":1,"15":0,"16":1},"f":{"0":9,"1":33},"b":{"0":[9,5,17,1,1,0]},"inputSourceMap":{"version":3,"file":"C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/logging/LogForwarder.ts","sources":["C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/logging/LogForwarder.ts"],"names":[],"mappings":";;;AAKA,gDAAuD;AAGvD,MAAa,YAAY;IAExB,YAAY,SAAiB;QAC5B,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC;IACjC,CAAC;IAED,GAAG,CAAC,QAAkB,EAAE,OAAe;QACtC,QAAQ,QAAQ,EAAE;YACjB,KAAK,kBAAQ,CAAC,KAAK;gBAClB,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;gBACnC,MAAM;YACP,KAAK,kBAAQ,CAAC,OAAO;gBACpB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;gBAClC,MAAM;YACP,KAAK,kBAAQ,CAAC,KAAK;gBAClB,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;gBACnC,MAAM;YACP,KAAK,kBAAQ,CAAC,KAAK;gBAClB,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;gBACnC,MAAM;YACP,KAAK,kBAAQ,CAAC,WAAW;gBACxB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;gBAClC,MAAM;YACP;gBACC,MAAM;SACP;IACF,CAAC;CACD;AA3BD,oCA2BC","sourcesContent":["/**\r\n * SPDX-License-Identifier: Apache-2.0\r\n * Copyright 2021 FINOS FDC3 contributors - see NOTICE file\r\n */\r\n\r\nimport { ILogger, LogLevel } from '@microsoft/signalr';\r\nimport { Logger } from 'ts-log';\r\n\r\nexport class LogForwarder implements ILogger {\r\n\texternalLogger: Logger;\r\n\tconstructor(extLogger: Logger) {\r\n\t\tthis.externalLogger = extLogger;\r\n\t}\r\n\r\n\tlog(logLevel: LogLevel, message: string): void {\r\n\t\tswitch (logLevel) {\r\n\t\t\tcase LogLevel.Error:\r\n\t\t\t\tthis.externalLogger.error(message);\r\n\t\t\t\tbreak;\r\n\t\t\tcase LogLevel.Warning:\r\n\t\t\t\tthis.externalLogger.warn(message);\r\n\t\t\t\tbreak;\r\n\t\t\tcase LogLevel.Debug:\r\n\t\t\t\tthis.externalLogger.debug(message);\r\n\t\t\t\tbreak;\r\n\t\t\tcase LogLevel.Trace:\r\n\t\t\t\tthis.externalLogger.trace(message);\r\n\t\t\t\tbreak;\r\n\t\t\tcase LogLevel.Information:\r\n\t\t\t\tthis.externalLogger.info(message);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f0cefc5a7874d4909283171abcaf4e656346c49d"},"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\utility\\ClientMiddlewareUtils.ts":{"path":"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\utility\\ClientMiddlewareUtils.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":15},"end":{"line":4,"column":52}},"4":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"5":{"start":{"line":6,"column":6},"end":{"line":6,"column":68}},"6":{"start":{"line":6,"column":51},"end":{"line":6,"column":63}},"7":{"start":{"line":8,"column":4},"end":{"line":8,"column":39}},"8":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"9":{"start":{"line":10,"column":26},"end":{"line":10,"column":33}},"10":{"start":{"line":11,"column":4},"end":{"line":11,"column":17}},"11":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":72}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":21}},"14":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"15":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"16":{"start":{"line":19,"column":31},"end":{"line":19,"column":42}},"17":{"start":{"line":20,"column":17},"end":{"line":20,"column":19}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"19":{"start":{"line":21,"column":21},"end":{"line":21,"column":141}},"20":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"21":{"start":{"line":21,"column":109},"end":{"line":21,"column":141}},"22":{"start":{"line":22,"column":4},"end":{"line":22,"column":36}},"23":{"start":{"line":23,"column":4},"end":{"line":23,"column":18}},"24":{"start":{"line":25,"column":0},"end":{"line":25,"column":62}},"25":{"start":{"line":26,"column":0},"end":{"line":26,"column":127}},"26":{"start":{"line":27,"column":16},"end":{"line":27,"column":67}},"27":{"start":{"line":28,"column":30},"end":{"line":37,"column":1}},"28":{"start":{"line":29,"column":14},"end":{"line":33,"column":5}},"29":{"start":{"line":34,"column":21},"end":{"line":34,"column":40}},"30":{"start":{"line":35,"column":4},"end":{"line":35,"column":59}},"31":{"start":{"line":36,"column":4},"end":{"line":36,"column":22}},"32":{"start":{"line":38,"column":0},"end":{"line":38,"column":54}},"33":{"start":{"line":39,"column":24},"end":{"line":57,"column":1}},"34":{"start":{"line":40,"column":4},"end":{"line":56,"column":5}},"35":{"start":{"line":41,"column":8},"end":{"line":41,"column":74}},"36":{"start":{"line":42,"column":28},"end":{"line":42,"column":65}},"37":{"start":{"line":43,"column":8},"end":{"line":52,"column":74}},"38":{"start":{"line":44,"column":12},"end":{"line":48,"column":15}},"39":{"start":{"line":45,"column":16},"end":{"line":45,"column":137}},"40":{"start":{"line":46,"column":31},"end":{"line":46,"column":53}},"41":{"start":{"line":47,"column":16},"end":{"line":47,"column":116}},"42":{"start":{"line":49,"column":12},"end":{"line":49,"column":90}},"43":{"start":{"line":52,"column":12},"end":{"line":52,"column":74}},"44":{"start":{"line":55,"column":8},"end":{"line":55,"column":75}},"45":{"start":{"line":58,"column":0},"end":{"line":58,"column":42}},"46":{"start":{"line":59,"column":22},"end":{"line":73,"column":1}},"47":{"start":{"line":60,"column":4},"end":{"line":63,"column":5}},"48":{"start":{"line":61,"column":8},"end":{"line":61,"column":90}},"49":{"start":{"line":62,"column":8},"end":{"line":62,"column":15}},"50":{"start":{"line":64,"column":4},"end":{"line":64,"column":86}},"51":{"start":{"line":65,"column":29},"end":{"line":65,"column":89}},"52":{"start":{"line":66,"column":33},"end":{"line":66,"column":95}},"53":{"start":{"line":67,"column":37},"end":{"line":67,"column":76}},"54":{"start":{"line":68,"column":35},"end":{"line":68,"column":78}},"55":{"start":{"line":69,"column":4},"end":{"line":70,"column":72}},"56":{"start":{"line":70,"column":8},"end":{"line":70,"column":72}},"57":{"start":{"line":71,"column":4},"end":{"line":72,"column":70}},"58":{"start":{"line":72,"column":8},"end":{"line":72,"column":70}},"59":{"start":{"line":74,"column":34},"end":{"line":78,"column":1}},"60":{"start":{"line":75,"column":4},"end":{"line":76,"column":26}},"61":{"start":{"line":76,"column":8},"end":{"line":76,"column":26}},"62":{"start":{"line":77,"column":4},"end":{"line":77,"column":67}},"63":{"start":{"line":79,"column":0},"end":{"line":79,"column":62}},"64":{"start":{"line":80,"column":27},"end":{"line":93,"column":1}},"65":{"start":{"line":81,"column":4},"end":{"line":84,"column":5}},"66":{"start":{"line":82,"column":8},"end":{"line":82,"column":80}},"67":{"start":{"line":83,"column":8},"end":{"line":83,"column":15}},"68":{"start":{"line":85,"column":4},"end":{"line":92,"column":7}},"69":{"start":{"line":86,"column":8},"end":{"line":91,"column":9}},"70":{"start":{"line":87,"column":12},"end":{"line":87,"column":23}},"71":{"start":{"line":90,"column":12},"end":{"line":90,"column":71}},"72":{"start":{"line":94,"column":24},"end":{"line":111,"column":1}},"73":{"start":{"line":95,"column":4},"end":{"line":98,"column":5}},"74":{"start":{"line":96,"column":8},"end":{"line":96,"column":51}},"75":{"start":{"line":97,"column":8},"end":{"line":97,"column":15}},"76":{"start":{"line":99,"column":4},"end":{"line":110,"column":5}},"77":{"start":{"line":100,"column":32},"end":{"line":100,"column":65}},"78":{"start":{"line":100,"column":52},"end":{"line":100,"column":64}},"79":{"start":{"line":101,"column":8},"end":{"line":104,"column":9}},"80":{"start":{"line":102,"column":12},"end":{"line":102,"column":46}},"81":{"start":{"line":103,"column":12},"end":{"line":103,"column":19}},"82":{"start":{"line":105,"column":8},"end":{"line":105,"column":42}},"83":{"start":{"line":106,"column":8},"end":{"line":106,"column":66}},"84":{"start":{"line":109,"column":8},"end":{"line":109,"column":65}},"85":{"start":{"line":112,"column":0},"end":{"line":112,"column":42}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":9,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":38},"end":{"line":6,"column":39}},"loc":{"start":{"line":6,"column":49},"end":{"line":6,"column":65}},"line":6},"2":{"name":"(anonymous_2)","decl":{"start":{"line":9,"column":6},"end":{"line":9,"column":7}},"loc":{"start":{"line":9,"column":28},"end":{"line":12,"column":1}},"line":9},"3":{"name":"(anonymous_3)","decl":{"start":{"line":13,"column":80},"end":{"line":13,"column":81}},"loc":{"start":{"line":13,"column":95},"end":{"line":15,"column":1}},"line":13},"4":{"name":"(anonymous_4)","decl":{"start":{"line":15,"column":5},"end":{"line":15,"column":6}},"loc":{"start":{"line":15,"column":20},"end":{"line":17,"column":1}},"line":15},"5":{"name":"(anonymous_5)","decl":{"start":{"line":18,"column":50},"end":{"line":18,"column":51}},"loc":{"start":{"line":18,"column":65},"end":{"line":24,"column":1}},"line":18},"6":{"name":"(anonymous_6)","decl":{"start":{"line":28,"column":30},"end":{"line":28,"column":31}},"loc":{"start":{"line":28,"column":77},"end":{"line":37,"column":1}},"line":28},"7":{"name":"(anonymous_7)","decl":{"start":{"line":39,"column":24},"end":{"line":39,"column":25}},"loc":{"start":{"line":39,"column":73},"end":{"line":57,"column":1}},"line":39},"8":{"name":"(anonymous_8)","decl":{"start":{"line":44,"column":56},"end":{"line":44,"column":57}},"loc":{"start":{"line":44,"column":76},"end":{"line":48,"column":13}},"line":44},"9":{"name":"(anonymous_9)","decl":{"start":{"line":59,"column":22},"end":{"line":59,"column":23}},"loc":{"start":{"line":59,"column":84},"end":{"line":73,"column":1}},"line":59},"10":{"name":"(anonymous_10)","decl":{"start":{"line":74,"column":34},"end":{"line":74,"column":35}},"loc":{"start":{"line":74,"column":60},"end":{"line":78,"column":1}},"line":74},"11":{"name":"(anonymous_11)","decl":{"start":{"line":80,"column":27},"end":{"line":80,"column":28}},"loc":{"start":{"line":80,"column":61},"end":{"line":93,"column":1}},"line":80},"12":{"name":"(anonymous_12)","decl":{"start":{"line":85,"column":24},"end":{"line":85,"column":25}},"loc":{"start":{"line":85,"column":29},"end":{"line":92,"column":5}},"line":85},"13":{"name":"(anonymous_13)","decl":{"start":{"line":94,"column":24},"end":{"line":94,"column":25}},"loc":{"start":{"line":94,"column":62},"end":{"line":111,"column":1}},"line":94},"14":{"name":"(anonymous_14)","decl":{"start":{"line":100,"column":47},"end":{"line":100,"column":48}},"loc":{"start":{"line":100,"column":52},"end":{"line":100,"column":64}},"line":100}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":12,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":12,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":9,"column":1}},{"start":{"line":9,"column":6},"end":{"line":12,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{"line":3,"column":4},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},{"start":{"line":5,"column":4},"end":{"line":7,"column":5}}],"line":5},"4":{"loc":{"start":{"line":5,"column":8},"end":{"line":5,"column":85}},"type":"binary-expr","locations":[{"start":{"line":5,"column":8},"end":{"line":5,"column":13}},{"start":{"line":5,"column":18},"end":{"line":5,"column":84}}],"line":5},"5":{"loc":{"start":{"line":5,"column":18},"end":{"line":5,"column":84}},"type":"cond-expr","locations":[{"start":{"line":5,"column":34},"end":{"line":5,"column":47}},{"start":{"line":5,"column":50},"end":{"line":5,"column":84}}],"line":5},"6":{"loc":{"start":{"line":5,"column":50},"end":{"line":5,"column":84}},"type":"binary-expr","locations":[{"start":{"line":5,"column":50},"end":{"line":5,"column":63}},{"start":{"line":5,"column":67},"end":{"line":5,"column":84}}],"line":5},"7":{"loc":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},{"start":{"line":10,"column":4},"end":{"line":10,"column":33}}],"line":10},"8":{"loc":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"type":"binary-expr","locations":[{"start":{"line":13,"column":26},"end":{"line":13,"column":30}},{"start":{"line":13,"column":34},"end":{"line":13,"column":57}},{"start":{"line":13,"column":63},"end":{"line":17,"column":1}}],"line":13},"9":{"loc":{"start":{"line":13,"column":63},"end":{"line":17,"column":1}},"type":"cond-expr","locations":[{"start":{"line":13,"column":80},"end":{"line":15,"column":1}},{"start":{"line":15,"column":5},"end":{"line":17,"column":1}}],"line":13},"10":{"loc":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":20},"end":{"line":18,"column":24}},{"start":{"line":18,"column":28},"end":{"line":18,"column":45}},{"start":{"line":18,"column":50},"end":{"line":24,"column":1}}],"line":18},"11":{"loc":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},{"start":{"line":19,"column":4},"end":{"line":19,"column":42}}],"line":19},"12":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":11}},{"start":{"line":19,"column":15},"end":{"line":19,"column":29}}],"line":19},"13":{"loc":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},{"start":{"line":21,"column":4},"end":{"line":21,"column":141}}],"line":21},"14":{"loc":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},{"start":{"line":21,"column":40},"end":{"line":21,"column":141}}],"line":21},"15":{"loc":{"start":{"line":21,"column":44},"end":{"line":21,"column":107}},"type":"binary-expr","locations":[{"start":{"line":21,"column":44},"end":{"line":21,"column":59}},{"start":{"line":21,"column":63},"end":{"line":21,"column":107}}],"line":21},"16":{"loc":{"start":{"line":43,"column":8},"end":{"line":52,"column":74}},"type":"if","locations":[{"start":{"line":43,"column":8},"end":{"line":52,"column":74}},{"start":{"line":43,"column":8},"end":{"line":52,"column":74}}],"line":43},"17":{"loc":{"start":{"line":60,"column":4},"end":{"line":63,"column":5}},"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":63,"column":5}},{"start":{"line":60,"column":4},"end":{"line":63,"column":5}}],"line":60},"18":{"loc":{"start":{"line":69,"column":4},"end":{"line":70,"column":72}},"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":70,"column":72}},{"start":{"line":69,"column":4},"end":{"line":70,"column":72}}],"line":69},"19":{"loc":{"start":{"line":71,"column":4},"end":{"line":72,"column":70}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":72,"column":70}},{"start":{"line":71,"column":4},"end":{"line":72,"column":70}}],"line":71},"20":{"loc":{"start":{"line":75,"column":4},"end":{"line":76,"column":26}},"type":"if","locations":[{"start":{"line":75,"column":4},"end":{"line":76,"column":26}},{"start":{"line":75,"column":4},"end":{"line":76,"column":26}}],"line":75},"21":{"loc":{"start":{"line":81,"column":4},"end":{"line":84,"column":5}},"type":"if","locations":[{"start":{"line":81,"column":4},"end":{"line":84,"column":5}},{"start":{"line":81,"column":4},"end":{"line":84,"column":5}}],"line":81},"22":{"loc":{"start":{"line":81,"column":8},"end":{"line":81,"column":59}},"type":"binary-expr","locations":[{"start":{"line":81,"column":8},"end":{"line":81,"column":32}},{"start":{"line":81,"column":36},"end":{"line":81,"column":59}}],"line":81},"23":{"loc":{"start":{"line":95,"column":4},"end":{"line":98,"column":5}},"type":"if","locations":[{"start":{"line":95,"column":4},"end":{"line":98,"column":5}},{"start":{"line":95,"column":4},"end":{"line":98,"column":5}}],"line":95},"24":{"loc":{"start":{"line":101,"column":8},"end":{"line":104,"column":9}},"type":"if","locations":[{"start":{"line":101,"column":8},"end":{"line":104,"column":9}},{"start":{"line":101,"column":8},"end":{"line":104,"column":9}}],"line":101}},"s":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":1,"12":0,"13":0,"14":1,"15":1,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":1,"26":1,"27":1,"28":0,"29":0,"30":0,"31":0,"32":1,"33":1,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":1,"46":1,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":1,"60":3,"61":0,"62":3,"63":1,"64":1,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":1,"73":1,"74":0,"75":0,"76":1,"77":1,"78":1,"79":1,"80":0,"81":0,"82":1,"83":1,"84":0,"85":1},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":1,"6":0,"7":0,"8":0,"9":0,"10":3,"11":0,"12":0,"13":1,"14":1},"b":{"0":[1,1,1],"1":[1,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[1,1,1],"9":[1,0],"10":[1,1,1],"11":[1,0],"12":[1,1],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,3],"21":[0,0],"22":[0,0],"23":[0,1],"24":[0,1]},"inputSourceMap":{"version":3,"file":"C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/utility/ClientMiddlewareUtils.ts","sources":["C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/utility/ClientMiddlewareUtils.ts"],"names":[],"mappings":"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","sourcesContent":["import { Context, ContextHandler } from '@finos/fdc3';\r\nimport { Logger } from 'ts-log';\r\nimport { AppIdentifier, MessageEnvelope } from '../DTO/receive/MessageEnvelope';\r\nimport { BroadcastContextEnvelope } from '../DTO/send/BroadcastContextEnvelope';\r\nimport { BackplaneTransport } from '../transport/BackplaneTransport';\r\nimport * as Utility from './UniqueMessageIdGenerator';\r\nimport { HubConnection } from '@microsoft/signalr';\r\n\r\nexport const buildBroadcastEnvelop = (\r\n\tappIdentifier: AppIdentifier,\r\n\tcontext: Context,\r\n\tchannelId: string,\r\n\tlogger: Logger\r\n): string => {\r\n\tlet dto: BroadcastContextEnvelope = {\r\n\t\tchannelId: channelId,\r\n\t\tcontext: context,\r\n\t\tmeta: { source: appIdentifier, uniqueMessageId: Utility.getUniqueMessageId() },\r\n\t};\r\n\tlet jsonString = JSON.stringify(dto);\r\n\tlogger.info(`BroadcastContextEnvelope: ${jsonString}`);\r\n\treturn jsonString;\r\n};\r\n\r\nexport const onHubConnection = (\r\n\tlogger: Logger,\r\n\tbackplaneTransport: BackplaneTransport,\r\n\tcontextHandlers: Map<string, ContextHandler[]>\r\n): void => {\r\n\ttry {\r\n\t\tlogger.info(`Registering on signalR hub for receiving broadcast`);\r\n\t\tlet hubConnection: HubConnection | undefined = backplaneTransport.getHubConnection();\r\n\t\tif (hubConnection) {\r\n\t\t\thubConnection.on('ReceiveBroadcastMessage', (messageEnvelop: MessageEnvelope) => {\r\n\t\t\t\tlogger.info(\r\n\t\t\t\t\t`Received broadcast context message from backplane with message id: ${messageEnvelop.meta.uniqueMessageId}`\r\n\t\t\t\t);\r\n\t\t\t\tlet fdc3Data = messageEnvelop.payload;\r\n\t\t\t\thandleContext(fdc3Data.context.type, fdc3Data.context, fdc3Data.channelId, logger, contextHandlers);\r\n\t\t\t});\r\n\t\t\tlogger.info(`Successfully registered on signalR hub for receiving broadcast`);\r\n\t\t} else logger.error(`Invalid operation: Transport not initialized.`);\r\n\t} catch (err) {\r\n\t\tthrow new Error(`Failed to register on hub for receiving message`);\r\n\t}\r\n};\r\n\r\nconst handleContext = (\r\n\tcontextType: string,\r\n\tcontext: Context,\r\n\tchannelId: string,\r\n\tlogger: Logger,\r\n\tcontextHandlers: Map<string, ContextHandler[]>\r\n): void => {\r\n\tif (!contextType) {\r\n\t\tlogger.error(`Received invalid context ${context}. type property is mandatory..`);\r\n\t\treturn;\r\n\t}\r\n\tlogger.info(`Received context type ${contextType}. Invoking registered handlers`);\r\n\tlet keyAllContextTypes: string = getBroadcastContextMapKey(undefined, channelId);\r\n\tlet keySpecificContextType: string = getBroadcastContextMapKey(contextType, channelId);\r\n\tlet listenersForAllContextType: ContextHandler[] | undefined = contextHandlers.get(keyAllContextTypes);\r\n\tlet specificContextListeners: ContextHandler[] | undefined = contextHandlers.get(keySpecificContextType);\r\n\tif (listenersForAllContextType) invokeHandlersSafe(listenersForAllContextType, context, logger);\r\n\tif (specificContextListeners) invokeHandlersSafe(specificContextListeners, context, logger);\r\n};\r\n\r\nexport const getBroadcastContextMapKey = (contextType: string | undefined, channel: string): string => {\r\n\tif (contextType == undefined) contextType = '*';\r\n\treturn `${contextType.toLowerCase()}-${channel.toLowerCase()}`;\r\n};\r\n\r\nconst invokeHandlersSafe = (handlerList: ContextHandler[] | undefined, context: Context, logger: Logger): void => {\r\n\tif (handlerList == undefined || handlerList.length == 0) {\r\n\t\tlogger.warn(`no handlers registered for context type: ${context.type}`);\r\n\t\treturn;\r\n\t}\r\n\thandlerList.forEach(x => {\r\n\t\ttry {\r\n\t\t\tx(context);\r\n\t\t} catch (err) {\r\n\t\t\tlogger.error(`An error occurred invoking handler: ${err}`);\r\n\t\t}\r\n\t});\r\n};\r\n\r\nexport const unsubscribeUtil = (\r\n\tlogger: Logger,\r\n\titem: ContextHandler[] | undefined,\r\n\ttype: string,\r\n\tkey: string,\r\n\thandler: ContextHandler\r\n): void => {\r\n\tif (!item) {\r\n\t\tlogger.error(`${type}: ${key} not found!`);\r\n\t\treturn;\r\n\t}\r\n\r\n\ttry {\r\n\t\tlet itemIndexToDelete: number = item.findIndex(x => x == handler);\r\n\t\tif (itemIndexToDelete < 0) {\r\n\t\t\tlogger.error('No handler found!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\titem.splice(itemIndexToDelete, 1);\r\n\t\tlogger.info(`Unsubscribe successful for ${type}: ${key}`);\r\n\t} catch (err) {\r\n\t\tlogger.error(`An error occurred in unsubscribe: ${err}`);\r\n\t}\r\n};\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b129912e92dbce9f4429a5e0823a873fb9676f42"},"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\utility\\UniqueMessageIdGenerator.ts":{"path":"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\utility\\UniqueMessageIdGenerator.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":36}},"2":{"start":{"line":4,"column":27},"end":{"line":6,"column":1}},"3":{"start":{"line":5,"column":4},"end":{"line":5,"column":44}},"4":{"start":{"line":7,"column":0},"end":{"line":7,"column":48}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":27},"end":{"line":4,"column":28}},"loc":{"start":{"line":4,"column":33},"end":{"line":6,"column":1}},"line":4}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1},"f":{"0":1},"b":{},"inputSourceMap":{"version":3,"file":"C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/utility/UniqueMessageIdGenerator.ts","sources":["C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/utility/UniqueMessageIdGenerator.ts"],"names":[],"mappings":";;;AAKO,MAAM,kBAAkB,GAAG,GAAW,EAAE;IAC9C,OAAO,IAAI,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;AACzC,CAAC,CAAC;AAFW,QAAA,kBAAkB,sBAE7B","sourcesContent":["/**\r\n * SPDX-License-Identifier: Apache-2.0\r\n * Copyright 2021 FINOS FDC3 contributors - see NOTICE file\r\n */\r\n\r\nexport const getUniqueMessageId = (): string => {\r\n\treturn Date.now() + '_' + Math.random();\r\n};\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3aa5415d845ecb19dad2deaed96848cb97c94b02"},"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\discovery\\BackplaneDiscoveryServiceClient.ts":{"path":"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\discovery\\BackplaneDiscoveryServiceClient.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":49}},"2":{"start":{"line":6,"column":8},"end":{"line":6,"column":29}},"3":{"start":{"line":9,"column":8},"end":{"line":9,"column":86}},"4":{"start":{"line":10,"column":8},"end":{"line":12,"column":11}},"5":{"start":{"line":11,"column":12},"end":{"line":11,"column":47}},"6":{"start":{"line":15,"column":0},"end":{"line":15,"column":74}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":4},"end":{"line":5,"column":5}},"loc":{"start":{"line":5,"column":24},"end":{"line":7,"column":5}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":8,"column":4},"end":{"line":8,"column":5}},"loc":{"start":{"line":8,"column":29},"end":{"line":13,"column":5}},"line":8},"2":{"name":"(anonymous_2)","decl":{"start":{"line":10,"column":27},"end":{"line":10,"column":28}},"loc":{"start":{"line":10,"column":38},"end":{"line":12,"column":9}},"line":10}},"branchMap":{},"s":{"0":1,"1":1,"2":25,"3":5,"4":5,"5":5,"6":1},"f":{"0":25,"1":5,"2":5},"b":{},"inputSourceMap":{"version":3,"file":"C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/discovery/BackplaneDiscoveryServiceClient.ts","sources":["C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/discovery/BackplaneDiscoveryServiceClient.ts"],"names":[],"mappings":";;;AAOA,MAAa,+BAA+B;IAE3C,YAAY,MAAc;QACzB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACtB,CAAC;IAGD,sBAAsB;QACrB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,gCAAgC,yBAAyB,EAAE,CAAC,CAAC;QAC9E,OAAO,IAAI,OAAO,CAAS,OAAO,CAAC,EAAE;YACpC,OAAO,CAAC,yBAAyB,CAAC,CAAC;QACpC,CAAC,CAAC,CAAC;IACJ,CAAC;CACD;AAbD,0EAaC","sourcesContent":["/**\r\n * SPDX-License-Identifier: Apache-2.0\r\n * Copyright 2021 FINOS FDC3 contributors - see NOTICE file\r\n */\r\n\r\nimport { Logger } from 'ts-log';\r\n\r\nexport class BackplaneDiscoveryServiceClient {\r\n\tprivate logger: Logger;\r\n\tconstructor(logger: Logger) {\r\n\t\tthis.logger = logger;\r\n\t}\r\n\t//Below method can be extended to reach any persistent storage(database/service discovery) through a service call\r\n\t// and return locally hosted backolane url with port number. Currently hardcoded for demo purpose.\r\n\tdiscoverBackplaneAsync(): Promise<string> {\r\n\t\tthis.logger.info(`Service discovery local url: ${'http://localhost:49201/'}`);\r\n\t\treturn new Promise<string>(resolve => {\r\n\t\t\tresolve('http://localhost:49201/');\r\n\t\t});\r\n\t}\r\n}\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1bf70c6d207d2703d221b78e195f2d934dd494cd"},"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\repository\\ChannelsRepository.ts":{"path":"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\repository\\ChannelsRepository.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":36}},"4":{"start":{"line":7,"column":24},"end":{"line":7,"column":70}},"5":{"start":{"line":8,"column":19},"end":{"line":8,"column":55}},"6":{"start":{"line":11,"column":8},"end":{"line":11,"column":41}},"7":{"start":{"line":12,"column":8},"end":{"line":12,"column":29}},"8":{"start":{"line":13,"column":8},"end":{"line":13,"column":49}},"9":{"start":{"line":14,"column":8},"end":{"line":14,"column":65}},"10":{"start":{"line":17,"column":8},"end":{"line":27,"column":11}},"11":{"start":{"line":20,"column":12},"end":{"line":20,"column":76}},"12":{"start":{"line":21,"column":26},"end":{"line":21,"column":74}},"13":{"start":{"line":22,"column":12},"end":{"line":23,"column":77}},"14":{"start":{"line":23,"column":16},"end":{"line":23,"column":77}},"15":{"start":{"line":24,"column":26},"end":{"line":24,"column":67}},"16":{"start":{"line":25,"column":12},"end":{"line":25,"column":139}},"17":{"start":{"line":25,"column":50},"end":{"line":25,"column":137}},"18":{"start":{"line":26,"column":12},"end":{"line":26,"column":98}},"19":{"start":{"line":30,"column":8},"end":{"line":30,"column":34}},"20":{"start":{"line":33,"column":0},"end":{"line":33,"column":48}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":4},"end":{"line":10,"column":5}},"loc":{"start":{"line":10,"column":68},"end":{"line":15,"column":5}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":57},"end":{"line":28,"column":5}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":31},"end":{"line":19,"column":32}},"loc":{"start":{"line":19,"column":43},"end":{"line":27,"column":9}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":25,"column":45},"end":{"line":25,"column":46}},"loc":{"start":{"line":25,"column":50},"end":{"line":25,"column":137}},"line":25},"5":{"name":"(anonymous_5)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":24},"end":{"line":31,"column":5}},"line":29}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":22,"column":12},"end":{"line":23,"column":77}},"type":"if","locations":[{"start":{"line":22,"column":12},"end":{"line":23,"column":77}},{"start":{"line":22,"column":12},"end":{"line":23,"column":77}}],"line":22}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":18,"7":18,"8":18,"9":18,"10":1,"11":2,"12":2,"13":2,"14":2,"15":0,"16":0,"17":0,"18":0,"19":1,"20":1},"f":{"0":1,"1":18,"2":1,"3":2,"4":0,"5":1},"b":{"0":[1,1,1],"1":[0,1],"2":[1,1],"3":[2,0]},"inputSourceMap":{"version":3,"file":"C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/repository/ChannelsRepository.ts","sources":["C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/repository/ChannelsRepository.ts"],"names":[],"mappings":";;;;;;AASA,uEAAkE;AAClE,wDAA6B;AAG7B,MAAa,kBAAkB;IAM9B,YAAY,wBAA4C,EAAE,gBAAkC,EAAE,MAAc;QAC3G,IAAI,CAAC,aAAa,GAAG,IAAI,KAAK,EAAe,CAAC;QAC9C,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;QACzC,IAAI,CAAC,wBAAwB,GAAG,wBAAwB,CAAC;IAC1D,CAAC;IAED,KAAK,CAAC,eAAe,CAAC,UAAkB,EAAE,iBAAyB;QAClE,MAAM,IAAA,kBAAK,GAAE;aACX,YAAY,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;aACvD,iBAAiB,CAAC,KAAK,IAAI,EAAE;YAC7B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,6CAA6C,CAAC,CAAC;YAChE,IAAI,OAAO,GAA8B,IAAI,CAAC,wBAAwB,CAAC,gBAAgB,EAAE,CAAC;YAC1F,IAAI,OAAO,IAAI,SAAS;gBAAE,MAAM,KAAK,CAAC,+CAA+C,CAAC,CAAC;YACvF,IAAI,OAAO,GAAc,MAAM,OAAO,CAAC,MAAM,CAAiB,mBAAmB,CAAC,CAAC;YACnF,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,2BAAW,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,gBAAgB,EAAE,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC;YAC/G,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,+CAA+C,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;QACvF,CAAC,CAAC,CAAC;IACL,CAAC;IAED,iBAAiB;QAChB,OAAO,IAAI,CAAC,aAAa,CAAC;IAC3B,CAAC;CACD;AA7BD,gDA6BC","sourcesContent":["/**\r\n * SPDX-License-Identifier: Apache-2.0\r\n * Copyright 2021 FINOS FDC3 contributors - see NOTICE file\r\n */\r\n\r\nimport { Channel } from '@finos/fdc3';\r\nimport { Logger } from 'ts-log';\r\nimport { BackplaneTransport } from '../transport/BackplaneTransport';\r\nimport { ClientMiddleware } from '../service/ClientMiddleware';\r\nimport { Fdc3Channel } from '../broadcast/channels/ChannelClient';\r\nimport polly from 'polly-js';\r\nimport { HubConnection } from '@microsoft/signalr';\r\n\r\nexport class ChannelsRepository {\r\n\tprivate backplaneTransportClient: BackplaneTransport;\r\n\tclientMiddleware: ClientMiddleware;\r\n\tlogger: Logger;\r\n\tsystemChannel: Array<Fdc3Channel>;\r\n\r\n\tconstructor(backplaneTransportClient: BackplaneTransport, clientMiddleware: ClientMiddleware, logger: Logger) {\r\n\t\tthis.systemChannel = new Array<Fdc3Channel>();\r\n\t\tthis.logger = logger;\r\n\t\tthis.clientMiddleware = clientMiddleware;\r\n\t\tthis.backplaneTransportClient = backplaneTransportClient;\r\n\t}\r\n\r\n\tasync InitializeAsync(retryCount: number, retryIntervalinMs: number): Promise<void> {\r\n\t\tawait polly()\r\n\t\t\t.waitAndRetry(Array(retryCount).fill(retryIntervalinMs))\r\n\t\t\t.executeForPromise(async () => {\r\n\t\t\t\tthis.logger.info(`Fetching system channels from backplane ...`);\r\n\t\t\t\tlet hubConn: HubConnection | undefined = this.backplaneTransportClient.getHubConnection();\r\n\t\t\t\tif (hubConn == undefined) throw Error('Invalid operation: Transport not initialized!');\r\n\t\t\t\tlet channel: Channel[] = await hubConn.invoke<Array<Channel>>('GetSystemChannels');\r\n\t\t\t\tthis.systemChannel = channel.map(x => new Fdc3Channel(x.id, x.type, this.clientMiddleware, x.displayMetadata));\r\n\t\t\t\tthis.logger.info(`Successfully populated channels repository: ${this.systemChannel}`);\r\n\t\t\t});\r\n\t}\r\n\r\n\tgetSystemChannels(): Fdc3Channel[] {\r\n\t\treturn this.systemChannel;\r\n\t}\r\n}\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d4c55bbce03457d122fae950d197edfaff7481b4"},"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\broadcast\\channels\\ChannelClient.ts":{"path":"C:\\GitRepos\\OpenSource\\desktop-agent-backplane\\src\\Finos.Fdc3.Backplane.Client.JS\\src\\broadcast\\channels\\ChannelClient.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":6,"column":8},"end":{"line":6,"column":35}},"3":{"start":{"line":7,"column":8},"end":{"line":7,"column":21}},"4":{"start":{"line":8,"column":8},"end":{"line":8,"column":25}},"5":{"start":{"line":9,"column":8},"end":{"line":9,"column":52}},"6":{"start":{"line":10,"column":8},"end":{"line":10,"column":47}},"7":{"start":{"line":13,"column":8},"end":{"line":13,"column":38}},"8":{"start":{"line":14,"column":8},"end":{"line":14,"column":65}},"9":{"start":{"line":17,"column":8},"end":{"line":17,"column":52}},"10":{"start":{"line":20,"column":30},"end":{"line":20,"column":34}},"11":{"start":{"line":21,"column":8},"end":{"line":21,"column":98}},"12":{"start":{"line":22,"column":8},"end":{"line":22,"column":31}},"13":{"start":{"line":25,"column":0},"end":{"line":25,"column":34}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":4},"end":{"line":5,"column":5}},"loc":{"start":{"line":5,"column":64},"end":{"line":11,"column":5}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":23},"end":{"line":15,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":35},"end":{"line":18,"column":5}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":45},"end":{"line":23,"column":5}},"line":19}},"branchMap":{},"s":{"0":1,"1":1,"2":3,"3":3,"4":3,"5":3,"6":3,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1},"f":{"0":3,"1":1,"2":1,"3":1},"b":{},"inputSourceMap":{"version":3,"file":"C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/broadcast/channels/ChannelClient.ts","sources":["C:/GitRepos/OpenSource/desktop-agent-backplane/src/Finos.Fdc3.Backplane.Client.JS/src/broadcast/channels/ChannelClient.ts"],"names":[],"mappings":";;;AAOA,MAAa,WAAW;IAOvB,YAAY,EAAU,EAAE,IAAY,EAAE,mBAAqC,EAAE,eAAiC;QAFtG,mBAAc,GAAmB,IAAI,CAAC;QAG7C,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;QACb,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,gBAAgB,GAAG,mBAAmB,CAAC;QAC5C,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;IACxC,CAAC;IAED,SAAS,CAAC,OAAgB;QACzB,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC;QAC9B,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;IAC1D,CAAC;IAED,iBAAiB,CAAC,WAAoB;QACrC,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IAC7C,CAAC;IAID,kBAAkB,CAAC,WAAgB,EAAE,OAAa;QACjD,IAAI,eAAe,GAAQ,IAAI,CAAC;QAChC,eAAe,GAAG,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,WAAW,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;QAC1F,OAAO,eAAe,CAAC;IACxB,CAAC;CACD;AA9BD,kCA8BC","sourcesContent":["/**\r\n * SPDX-License-Identifier: Apache-2.0\r\n * Copyright 2021 FINOS FDC3 contributors - see NOTICE file\r\n */\r\n\r\nimport { Channel, Context, ContextHandler, DisplayMetadata, Listener } from '@finos/fdc3';\r\nimport { ClientMiddleware } from '../../service/ClientMiddleware';\r\nexport class Fdc3Channel implements Channel {\r\n\tid: string;\r\n\ttype: string;\r\n\tdisplayMetadata?: DisplayMetadata | undefined;\r\n\tprivate clientMiddleware: ClientMiddleware;\r\n\tprivate currentContext: Context | null = null;\r\n\r\n\tconstructor(id: string, type: string, desktopAgentService: ClientMiddleware, displayMetadata?: DisplayMetadata) {\r\n\t\tthis.id = id;\r\n\t\tthis.type = type;\r\n\t\tthis.clientMiddleware = desktopAgentService;\r\n\t\tthis.displayMetadata = displayMetadata;\r\n\t}\r\n\r\n\tbroadcast(context: Context): void {\r\n\t\tthis.currentContext = context;\r\n\t\tthis.clientMiddleware.broadcastContext(context, this.id);\r\n\t}\r\n\r\n\tgetCurrentContext(contextType?: string): Promise<Context | null> {\r\n\t\treturn Promise.resolve(this.currentContext);\r\n\t}\r\n\r\n\taddContextListener(handler: ContextHandler): Listener;\r\n\taddContextListener(contextType: string | null, handler: ContextHandler): Listener;\r\n\taddContextListener(contextType: any, handler?: any): Listener {\r\n\t\tlet contextListener: any = null;\r\n\t\tcontextListener = this.clientMiddleware.addContextListener(contextType, handler, this.id);\r\n\t\treturn contextListener;\r\n\t}\r\n}\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b71367dfe9a9295d1e0a481861faddd9e99b3054"}}